{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
 <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="MediaCenter, Template, eCommerce">
    <meta name="robots" content="all">
    <title>{% block title %}{{single_product.product_name}}{% endblock title %} - WaseemInt</title>
    <link rel="shortcut icon" href="{% static 'assets/images/wlogo.png' %}" type="image/x-icon">

    <!-- Preconnect for Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>



    <!-- Load CSS Files -->
    <link rel="stylesheet" href="{% static 'assets/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/main.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/blue.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/bootstrap-select.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/font-awesome.css' %}">
    <link rel="stylesheet" href="{% static 'custom/css/jquery.miniColors.css' %}" />
    <link rel="stylesheet" href="{% static 'custom/css/jquery.simplecolorpicker.css' %}" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css" />

    <!-- Load JavaScript Files -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js" integrity="sha512-CeIsOAsgJnmevfCi2C7Zsyy6bQKi43utIjdA87Q0ZY84oDqnI0uwfM9+bKiIkI75lUeI00WG/+uJzOmuHlesMA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script type="text/javascript" src="{% static 'custom/js/tshirtEditor.js' %}"></script>
    <script type="text/javascript" src="{% static 'custom/js/jquery.miniColors.min.js' %}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

<style>
    ul.nav{
        list-style: none;
        display: flex;
        flex-wrap: wrap;
    }
    .color-preview {
	      	border: 1px solid #CCC;
	      	margin: 2px;
	      	zoom: 1.5;
	      	vertical-align: top;
	      	display: inline-block;
	      	cursor: pointer;
	      	overflow: hidden;
	      	width: 20px;
	      	height: 20px;
            display: inline-block;
            margin-right: 1px;
	      }

</style>

</head>
<body >
{% include "includes/navbar.html" %}

<style>
	/* Styles for the WhatsApp icon */
	.whatsapp-icon {
	  position: fixed;
	  bottom: 20px; /* Adjust as needed */
	  right: 20px; /* Adjust as needed */
	  z-index: 9999; /* Ensure it's above other content */
	}

	.whatsapp-icon i {
	  font-size: 40px; /* Adjust icon size as needed */
	  color: #25d366; /* WhatsApp icon color */
	}
  </style>
  <a href="https://wa.me/923016543034" class="whatsapp-icon" target="_blank">
	<i class="fa fa-whatsapp"></i>
  </a>


<br>
<style>
    .ownlogoc{
        width: 100%;
        border: 2px solid black;
        padding: 10px;
        text-align: center;
        cursor: pointer;

    }
    .ownlogoc:hover{

        background-color: black;
        color: white;
    }
    .ownlogoc:active{
    background-color: #ccc;
    color: #000;
    }
    #text .btn {
    margin-bottom: 10px;
    }

    .modal-dialog {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: calc(100% - 60px);
    }
    .modal-content {
    width: 100%;
    max-width: 600px;
    }
    #cropImage {
    max-width: 100%;
    }

</style>

<div id="cropModal" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">Crop Image</h4>
            </div>
            <div class="modal-body">
                <img id="cropImage" class="img-responsive" src="" alt="Crop Image">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="cropImageButton">Crop</button>
            </div>
        </div>
    </div>
</div>



<div class="container my-5">
    <h1 class="">{{single_product.product_name}}</h1>
</div>
<br><br>

<div class="container">
    <div class="row g-5">
        <div class="col-md-3 col-12">
            <div class="">

<style>
.nav-tabs {
            overflow-x: auto;
            overflow-y: hidden; /* Hide y-axis scrollbar */
            white-space: nowrap;
            display: flex;
            -webkit-overflow-scrolling: touch;
            border-bottom: none;
        }

        .nav-tabs>li {
            float: none;
            display: inline-block;
        }

        .nav-tabs>li>a {
            white-space: nowrap;
            display: flex;
            align-items: center;
        }

        .nav-tabs::-webkit-scrollbar {
            height: 6px;
        }

        .nav-tabs::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 3px;
        }

        .nav-tabs::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        .nav-tabs::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
</style>

                <div class="panel panel-deafult">
                <ul class="nav nav-tabs">
                    <li class="active"><a href="#shirtcolor" data-toggle="tab"> Color</a></li>
                  <li><a href="#logos" data-toggle="tab">Logos</a></li>
                  <li><a href="#text" data-toggle="tab">Text</a></li>
                  <li><a href="#shapes" data-toggle="tab">Shapes</a></li>
                  <li><a href="#bgimgaes" data-toggle="tab">Designs</a></li>
                </ul>
            </div>


              <div class="tab-content ">

                <div id="shirtcolor" class="tab-pane fade in active">
                    <div class="well">
                        <label>
                            <input type="radio" name="colorType" value="plain" checked> Plain Color
                        </label>
                        <label>
                            <input type="radio" name="colorType" value="gradient"> Gradient Color
                        </label>

                        <div id="plainColorOptions">
                            <ul class="nav">
                                <li class="color-preview" title="White" style="background-color:#ffffff;"></li>
                                <li class="color-preview" title="Black" style="background-color:#1f1e1e;"></li>
                                {% for i in colors %}
                                    <li class="color-preview" title="{{i.color}}" style="background-color:{{i.color}};"></li>
                                {% endfor %}

                            </ul>
                        </div>

                        <div id="gradientColorOptions" style="display: none;">
                            <label for="gradientType">Gradient Type:</label>
                            <select id="gradientType" class="form-control" name="gradientType">
                                <option value="linear">Linear</option>
                                <option value="radial">Radial</option>
                            </select>

                            <label for="numGradientColors">Number of Gradient Colors:</label>
                            <select id="numGradientColors" class="form-control" name="numGradientColors">
                                <option value="2">2 Colors</option>
                                <option value="3">3 Colors</option>
                                <option value="4">4 Colors</option>
                            </select>

                            <div id="gradientColorInputs">
                                <label for="gradientStart">Start Color:</label>
                                <input type="color" class="form-control gradient-color-input" id="gradientStart" name="gradientStart" value="#ffffff">

                                <label for="gradientEnd">End Color:</label>
                                <input type="color" class="form-control gradient-color-input" id="gradientEnd" name="gradientEnd" value="#1f1e1e">
                            </div>

                            <label for="gradientDirection">Direction:</label>
                            <select id="gradientDirection" class="form-control" name="gradientDirection">
                                <option value="to right">Left to Right</option>
                                <option value="to left">Right to Left</option>
                                <option value="to bottom">Top to Bottom</option>
                                <option value="to top">Bottom to Top</option>
                                <option value="custom">Custom (Degrees)</option>
                            </select>

                            <div id="degreeInputContainer" style="display: none;">
                                <label for="gradientDegree">Enter Degrees:</label>
                                <input type="number" class="form-control" id="gradientDegree" name="gradientDegree" value="0" min="0" max="360">
                            </div>
                        </div>
                    </div>
                </div>








                <div id="logos" class="tab-pane fade">
                    <div class="well">
                            <div>
                                <label for="ownlogo" class="ownlogoc" >Upload Your Own Logo</label>
                                <input style="display: none;" id="ownlogo" accept="image/*" type="file" onchange="uploadLogo(event)">
                            </div>
                            <hr>
                            <label for="opacity-slider" id="opacity-slider-label">Opacity:</label>
                            <input type="range" id="opacity-slider" min="0" max="1" step="0.01" value="1">

                            <hr>

                        <div id="avatarlist" style="height: 365px;overflow: auto;">
                            {% for logo in custom_logo %}
                            <img style="cursor:pointer;height: 86px;width: 86px;margin-left: 10px;margin-bottom: 10px;" class="img-polaroid" src="{{logo.image.url}}">
                            {% endfor %}
                        </div>

                    </div>
                </div>

                <div id="text" class="tab-pane fade">
                    <div class="well">
                        <div class="input-group">
                            <textarea class="form-control" style="padding: 18px;" id="text-string" type="text" placeholder="Add text here..."></textarea>
                            <span class="input-group-btn">
                                <button id="add-text" class="btn btn-default" type="button" title="Add text">Add</button>
                            </span>
                        </div>
                        <hr>
                        <button style="margin: 2px;background: transparent;border: 1px solid gainsboro;" id="align-left-text" title="Align Left"><img height="25" width="25" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAXUlEQVR4nO3WwQkAMQgEQPtveq+AfD0SZQbyd1mIVsHvMvQdbg8kyNpGAGbJlm80gpRGYkMD5IGlmI6L4PZAgqxtBGCWbPlGI0hpJDY0QB5Yium4CG4PJMjaRqD6fCcVJQZ9Gl14AAAAAElFTkSuQmCC"></button>
                        <button style="margin: 2px;background: transparent;border: 1px solid gainsboro;" id="align-right-text" title="Align Right"><img height="25" width="25" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAWElEQVR4nO3VwQkAMQwDsOy/tG+AfnuUuhLkH2NIZuB3uXQWpxcSpLYRgDek5fxGkNFIfHagRy6dxemFBKltBOANaTm/EWQ0Ep8d6JFLZ3F6IUFqG4HZ5wNbzSUGz+oQgAAAAABJRU5ErkJggg=="></button>
                        <button style="margin: 2px;background: transparent;border: 1px solid gainsboro;" id="align-center-text" title="Align Center"><img height="25" width="25" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAWElEQVR4nO3VwQkAMQwDsOy/tG+AfnuUuhLkH2NIZuB3uXQWpxcSpLYRgB5pObERZDQS3xt4Qy6dxemFBKltBKBHWk5sBBmNxPcG3pBLZ3F6IUFqG4HZ5wNBcSUGoVfKQQAAAABJRU5ErkJggg=="></button>

                        <div class="input-group">
                            <label for="line-height">Line Height:</label>
                            <input id="line-height" type="number" step="0.1" min="0" placeholder="Line Height">
                        </div>

                        <div class="input-group">
                            <label for="word-spacing">Word Spacing:</label>
                            <input id="word-spacing" type="number" step="0.1" min="0" placeholder="Word Spacing">
                        </div>
                        <script>


                            // Function to align text left
document.getElementById('align-left-text').addEventListener('click', function() {
var activeObject = canvas.getActiveObject();
if (activeObject && activeObject.type === 'text') {
    activeObject.set('textAlign', 'left');
    canvas.renderAll();
}
});

// Function to align text right
document.getElementById('align-right-text').addEventListener('click', function() {
var activeObject = canvas.getActiveObject();
if (activeObject && activeObject.type === 'text') {
    activeObject.set('textAlign', 'right');
    canvas.renderAll();
}
});

// Function to align text center
document.getElementById('align-center-text').addEventListener('click', function() {
var activeObject = canvas.getActiveObject();
if (activeObject && activeObject.type === 'text') {
    activeObject.set('textAlign', 'center');
    canvas.renderAll();
}
});
// Update text properties when input values change
document.getElementById('line-height').addEventListener('input', function() {
var activeObject = canvas.getActiveObject();
if (activeObject && activeObject.type === 'text') {
    activeObject.set('lineHeight', parseFloat(this.value));
    canvas.renderAll();
}
});

document.getElementById('word-spacing').addEventListener('input', function() {
var activeObject = canvas.getActiveObject();
if (activeObject && activeObject.type === 'text') {
    activeObject.set('charSpacing', parseFloat(this.value));
    canvas.renderAll();
}
});

                        </script>
                        <br>

                        <div id="texteditor" class="btn-toolbar" role="toolbar">
                                <div class="dropdown">
                                    <button id="font-family" style="width: 100%;" class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" title="Font Style">
                                        <i class="icon-font" style="width:19px;height:19px;">A</i>
                                        <span class="caret"></span>
                                    </button>
                                    <ul class="dropdown-menu">
                                        {% for i in fonts %}
                                        <li><a tabindex="-1" onclick="setFont('{{i.font_name}}');" style="font-family:{{i.font_name}} !important;cursor: pointer;">{{i.font_name}}</a></li>
                                    {% endfor %}


                                    </ul>
                                    {% for font in fonts %}
                                    <style>
                                        @font-face {
                                            font-family: '{{ font.font_name }}';
                                            src: url('{{ font.font_file.url }}') format('truetype');
                                        }
                                    </style>
                                {% endfor %}
                                </div>
                                <div class="btn-group" role="group" style="width: 100%;">
                                <button id="text-bold" class="btn btn-default" data-original-title="Bold"><img src="{% static 'custom/img/font_bold.png' %}" height="" width=""></button>
                                <button id="text-italic" class="btn btn-default" data-original-title="Italic"><img src="{% static 'custom/img/font_italic.png' %}" height="" width=""></button>
                               </div>

                               <a class="btn btn-default" href="#" rel="tooltip" data-placement="top" data-original-title="Background Color">
                                <label for="">Background: </label>
                                <input type="color" id="text-bgcolor" class="color-picker" size="7" value="#000000">
                            </a>
                            <a class="btn btn-default" href="#" rel="tooltip" data-placement="top" data-original-title="Font Color">
                                    <label for="">Text Color:</label>
                                    <input type="color" id="text-fontcolor" class="color-picker" size="7" value="#000000">
                                </a>
                                <a class="btn btn-default" href="#" rel="tooltip" data-placement="top" data-original-title="Font Border Color">
                                    <label for="">Border Color:</label>
                                    <input type="color" id="text-strokecolor" class="color-picker" size="7" value="#000000">
                                </a>
                        </div>
                    </div>
                </div>

                <style>
 .shape-controls-container {
            display: none;
            margin-top: 10px;
        }
        .shape-option {
            cursor: pointer;
            margin: 10px;
        }
                </style>
                <div id="shapes" class="tab-pane fade">
                    <div class="well">
                        <div class="shape-controls-container" id="shapeControls">



                            <div>
                                <label for="shapeColorPickerCustom">Select Color:</label><br>
                                <input type="color" class="form-control" id="shapeColorPickerCustom" value="#000000">
                                <span>Make Sure <b>Plain</b> Color is selcted from bottom if you want to change its border color. Happy Editing! </span>
                            </div>
                            <div>
                                <label for="borderWidthCustom">Border Width:</label><br>
                                <input type="number" class="form-control" id="borderWidthCustom" value="8" min="1">
                            </div>
                            <div>
                                <label for="borderStyleCustom">Border Style:</label><br>
                                <select class="form-control" id="borderStyleCustom">
                                    <option value="solid">Solid</option>
                                    <option value="dashed">Dashed</option>
                                    <option value="dotted">Dotted</option>
                                    <option value="double">Double</option>
                                    <option value="longDash">Long Dash</option>
                                    <option value="shortDash">Short Dash</option>
                                    <option value="dashDot">Dash Dot</option>
                                    <option value="dashDotDot">Dash Dot Dot</option>
                                    <option value="wideDots">Wide Dots</option>
                                    <option value="evenDashDot">Even Dash Dot</option>
                                    <option value="tripleDash">Triple Dash</option>
                                    <option value="smallDashed">Small Dashed</option>
                                    <option value="largeDashed">Large Dashed</option>
                                    <option value="sparseDots">Sparse Dots</option>
                                    <option value="dashDotLong">Dash Dot Long</option>
                                    <option value="complexPattern">Complex Pattern</option>
                                    <option value="hidden">Hidden</option>
                                </select>
                            </div>


                            <div>
                                <label>Fill Type:</label><br>
                                <input type="radio" name="fillType" id="plainColorOption" value="plain" checked> Plain Color
                                <input type="radio" name="fillType" id="gradientOption" value="gradient"> Gradient
                            </div>

                            <div id="plainColorControls">
                                <label for="fillColorPickerCustom">Fill Color:</label><br>
                                <input type="color" class="form-control" id="fillColorPickerCustom" value="#ffffff">
                                <input type="checkbox" id="fillTransparentCustom"> Transparent
                            </div>

                            <div id="gradientControls" style="display: none;">
                                <label for="gradientColorPicker1">Gradient Color 1:</label><br>
                                <input type="color" class="form-control" id="gradientColorPicker1" value="#ff0000">
                                <label for="gradientColorPicker2">Gradient Color 2:</label><br>
                                <input type="color" class="form-control" id="gradientColorPicker2" value="#0000ff">
                                <label for="gradientTypeCustom">Gradient Type:</label><br>
                                <select class="form-control" id="gradientTypeCustom">
                                    <option value="linear">Linear</option>
                                    <option value="radial">Radial</option>
                                </select>
                            </div>





                        </div>
                        <span>If you want to add color shapes please first <b>select Color from color box!</b></span>
                        <hr>
                        <style>
                            .shape-container{
                                display: inline !important;
                            }
                        </style>
                            <div class="row" id="shapeOptionsContainer">
                                <!-- Shapes will be dynamically inserted here -->
                            </div>
                    </div>

                </div>

                <div id="bgimgaes" class="tab-pane fade">
                    <div class="well">
                        <div id="imageOptions">
 			    <img class="optionImage" style="margin-top: 5px;" src="{{single_product.images.url}}" width="100" height="100">
                            <img class="optionImage" style="margin-top: 5px;" src="{{single_product.images_hover.url}}" width="100" height="100">
                            <img class="optionImage" style="margin-top: 5px;" src="{{single_product.images_three.url}}" width="100" height="100">
                            <img class="optionImage" style="margin-top: 5px;" src="{{single_product.images_four.url}}" width="100" height="100">
                            <img class="optionImage" style="margin-top: 5px;" src="{{single_product.images_five.url}}" width="100" height="100">
                            {% for gallery_image in product_gallery %}
                            	<img class="optionImage" style="margin-top: 5px;" src="{{gallery_image.image.url}}" width="100" height="100">
                            {% endfor %}
			</div>
                    </div>
                </div>




              </div>


            </div>
        </div>
        <div class="col-md-6 col-12">
            <div align="center" style="min-height: 32px;">
                <div class="clearfix">



                    <div class="btn-group inline pull-left" id="texteditor" style="display:block !important">

                        <button id="drawing-mode" class="btn btn-default">
                            <i class="fa fa-pencil"></i>
                        </button>

                        <button title="Zoom In"  onclick="resizePlus()" class="btn btn-default">
                            <i class="fa fa-search-plus"></i>
                        </button>
                        <button title="Zoom Out"  onclick="resizeMinus()" class="btn btn-default">
                            <i class="fa fa-search-minus"></i>
                        </button>
                        <button title="Rotate"  onclick="rotate()" class="btn btn-default">
                            <i class="fa fa-refresh"></i>
                        </button>
                        <button title="Line"  id="draw" class="btn btn-default">
                            <i class="fa fa-minus" style="transform: rotate(120deg);"></i>
                        </button>



                    </div>

                    <div class="pull-right" align="" id="imageeditor" style="display:block !important">
                      <div class="btn-group">
                           <button style="display: none;" class="btn" id="bring-to-front" title="Bring to Front"><i class="fa fa-fast-backward rotate" style="display: none; height:19px;transform: rotate(90deg);"></i></button>
                          <button style="display: none;" class="btn" id="send-to-back" title="Send to Back"><i class="fa fa-fast-backward rotate" style="display: none; height:19px;transform: rotate(270deg)"></i></button>
                          <button style="display: none;" id="flip" type="button" class="btn" title="Show Back View" ><i class="fa fa-retweet" style="display: none; height:19px;"></i></button>




                          <button id="remove-selected" class="btn" title="Delete selected item"><i class="fa fa-trash" style="height:19px;"></i></button>

                          <button id="clearCanvasButton" class="btn btn-danger">Clear Canvas</button>

                        </div>
                    </div>
                </div>
            </div>



            <br>
            <button style="background: transparent;border: none;color: rgb(17,0,255);" onclick="loadPage(0)"><ins> Page 1</ins></button>
            <button style="background: transparent;border: none;color: rgb(17,0,255);" onclick="loadPage(1)"><ins> Page 2</ins></button>
            <button style="background: transparent;border: none;color: rgb(17,0,255);" onclick="loadPage(2)"><ins> Page 3</ins></button>
            <button style="background: transparent;border: none;color: rgb(17,0,255);" onclick="loadPage(3)"><ins> Page 4</ins></button>
            <button style="background: transparent;border: none;color: rgb(17,0,255);" onclick="loadPage(4)"><ins> Page 5</ins></button>


            <style>
                /* Default styles (for desktop screens) */
#shirtDiv {
    width: 600px;
    height: 530px;
    position: relative;
}

#drawingArea {
    position: absolute;
    top: 10px;
    left: 50px;
    z-index: 10;
    width: 450px;
    height: 510px;
}

#tcanvas {
    width: 100%;
    height: 100%;
    -webkit-user-select: none;
}

/* Responsive styles (for mobile screens) */
@media (max-width: 767px) {
    #shirtDiv {
        width: 100%;
        height: auto; /* Allows the height to adjust based on the width */
    }

    #tshirtFacing {
        width: 100%;
        height: auto; /* Maintain aspect ratio */
    }

    #drawingArea {
        top: 5px;
        left: 5%;
        width: 90%;
        height: auto;
    }

    #tcanvas {
        width: 100%;
        height: auto;
    }
}

            </style>


            <div id="shirtDiv" class="page" >
                <img id="tshirtFacing" height="530" width="600" src="{{single_product.images.url}}" />
                <div id="drawingArea" style="position: absolute; top: 10px; left: 50px; z-index: 10; width: 450px; height: 510px;">
                    <canvas id="tcanvas" width="450" height="550" class="hover" style="-webkit-user-select: none;"></canvas>
                </div>
            </div>



            <script>
                var canvas;
                var pages = [null, null, null, null];
                var currentPage = 0;

                function initializeCanvas() {
                    canvas = new fabric.Canvas('tcanvas', {
                        hoverCursor: 'pointer',
                        selection: true,
                        selectionBorderColor: 'blue'
                    });

                    canvas.on({
                        'object:moving': function (e) {
                            e.target.opacity = 0.5;
                        },
                        'object:modified': function (e) {
                            e.target.opacity = 1;
                            updateInputs(e.target);
                        },
                        'object:selected': function(e) {
                            onObjectSelected(e.target);
                        },
                        'selection:updated': function(e) {
                            onObjectSelected(e.target);
                        },
                        'selection:cleared': onSelectedCleared
                    });

                    const originalFindTarget = canvas.findTarget.bind(canvas);
                    canvas.findTarget = function (e) {
                        const target = originalFindTarget(e);
                        if (target) {
                            if (this._hoveredTarget !== target) {
                                canvas.fire('object:over', { target });
                                if (this._hoveredTarget) {
                                    canvas.fire('object:out', { target: this._hoveredTarget });
                                }
                                this._hoveredTarget = target;
                            }
                        } else if (this._hoveredTarget) {
                            canvas.fire('object:out', { target: this._hoveredTarget });
                            this._hoveredTarget = null;
                        }
                        return target;
                    };

                    canvas.on('object:over', function (e) {
                        // e.target.set('fill', 'red');
                        // canvas.renderAll();
                    });

                    canvas.on('object:out', function (e) {
                        // e.target.set('fill', 'green');
                        // canvas.renderAll();
                    });
                }

                function saveCurrentPage() {
                    var shirtDiv = document.getElementById('shirtDiv');
                    var shirtDivState = {
                        imgSrc: document.getElementById('tshirtFacing').src,
                        bgType: shirtDiv.style.backgroundImage ? 'gradient' : 'color',
                        bgColor: shirtDiv.style.backgroundColor,
                        bgGradient: shirtDiv.style.backgroundImage, // Gradient info
                        canvasState: canvas.toJSON()
                    };
                    pages[currentPage] = shirtDivState;
                }

                function loadPage(pageIndex) {
                    saveCurrentPage();
                    currentPage = pageIndex;

                    if (pages[pageIndex]) {
                        document.getElementById('tshirtFacing').src = pages[pageIndex].imgSrc;

                        var shirtDiv = document.getElementById('shirtDiv');
                        if (pages[pageIndex].bgType === 'gradient') {
                            shirtDiv.style.backgroundImage = pages[pageIndex].bgGradient;
                            shirtDiv.style.backgroundColor = ''; // Remove plain color
                        } else {
                            shirtDiv.style.backgroundColor = pages[pageIndex].bgColor;
                            shirtDiv.style.backgroundImage = ''; // Remove gradient
                        }

                        canvas.clear();
                        canvas.loadFromJSON(pages[pageIndex].canvasState, function() {
                            canvas.renderAll();

                            canvas.forEachObject(function(obj) {
                                obj.set('selectable', true);
                            });
                            canvas.renderAll();
                        });
                    } else {
                        document.getElementById('tshirtFacing').src = "{{single_product.images.url}}"; // Replace with default image
                        var defaultBackground = 'linear-gradient(red, pink)'; // Default gradient
                        document.getElementById('shirtDiv').style.backgroundImage = defaultBackground;
                        document.getElementById('shirtDiv').style.backgroundColor = ''; // No plain color
                        canvas.clear();
                    }
                }

                function setupDefaultPages() {
                    var defaultSettings = [
                        { imgSrc: "{{single_product.images.url}}", bgType: "gradient", bgColor: "", bgGradient: "linear-gradient(red, pink)" },
                        { imgSrc: "{{single_product.images_hover.url}}", bgType: "color", bgColor: "#FFEEEE", bgGradient: "" },
                        { imgSrc: "{{single_product.images_three.url}}", bgType: "color", bgColor: "#EEFFEE", bgGradient: "" },
                        { imgSrc: "{{single_product.images_four.url}}", bgType: "color", bgColor: "#EEEEFF", bgGradient: "" },
                        { imgSrc: "{{single_product.images_five.url}}", bgType: "color", bgColor: "#EEEEEE", bgGradient: "" }
                    ];

                    for (var i = 0; i < 5; i++) {
                        pages[i] = {
                            imgSrc: defaultSettings[i].imgSrc,
                            bgType: defaultSettings[i].bgType,
                            bgColor: defaultSettings[i].bgColor,
                            bgGradient: defaultSettings[i].bgGradient,
                            canvasState: null // Empty canvas
                        };
                    }

                    // Load the first page
                    loadPage(0);
                }

                $(document).ready(function () {
                    initializeCanvas(); // Initialize the canvas on document ready
                    setupDefaultPages(); // Setup default pages
                });
            </script>
        </div>
        <div class="col-md-3 col-12">
            <div class="well">
                <h3>Configuration Tools</h3>
                <hr>
                <span>Remove Image Background:</span>
                <br>
                <a style="border-bottom: 1px solid black;" href="https://www.remove.bg/" target="_blank" >https://tinyurl.com/y8d7g8pk <i class="fa fa-external-link" aria-hidden="true"></i>
                </a>
                <hr>
                <p>
                    <table class="table">
                        <tr>
                            <div class="object-options">
                                <h4>Object Options:</h4>
                                <button style="background:transparent !important;margin:2px;border:1px solid black;" id="flip-v"><svg width="25" height="25" enable-background="new 0 0 16 16" viewBox="0 0 16 20" xml:space="preserve"><g transform="matrix(1.5365 0 0 1.5385 -.45052 -3.0769)"><rect x="5" y="8" width="1" height="1"></rect><rect x="7" y="8" width="1" height="1"></rect><rect x="9" y="8" width="1" height="1"></rect><rect x="1" y="8" width="1" height="1"></rect><rect x="3" y="8" width="1" height="1"></rect><path d="M 1,2 5.5,6 10,2 Z M 7.37,3 5.5,4.662 3.63,3 Z"></path><polygon points="5.5 11 1 15 10 15"></polygon></g></svg></button>
                                <button style="background:transparent !important;margin:2px;border:1px solid black;" id="flip-h"><svg width="25" height="25" enable-background="new 0 0 16 16" viewBox="0 0 16 20" xml:space="preserve"><g transform="matrix(0 1.5365 1.5385 0 -5.0769 1.5495)"><rect x="5" y="8" width="1" height="1"></rect><rect x="7" y="8" width="1" height="1"></rect><rect x="9" y="8" width="1" height="1"></rect><rect x="1" y="8" width="1" height="1"></rect><rect x="3" y="8" width="1" height="1"></rect><path d="M 1,2 5.5,6 10,2 Z M 7.37,3 5.5,4.662 3.63,3 Z"></path><polygon points="10 15 5.5 11 1 15"></polygon></g></svg></button>
                                <button style="background:transparent !important;margin:2px;border:1px solid black;" id="bring-fwd"><svg width="25" height="25" x="0px" y="0px" viewBox="0 0 1000 1000" enable-background="new 0 0 1000 1000" xml:space="preserve"><g><path d="M10,10h686v686H10V10 M990,304v686H304V794h98v98h490V402h-98v-98H990z"></path></g></svg></button>
                                <button style="background:transparent !important;margin:2px;border:1px solid black;" id="bring-back"><svg width="25" height="25" enable-background="new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xml:space="preserve"><path d="m990 990h-686v-686h686v686m-980-294v-686h686v680h-98v-582h-490v490h200v98z"></path><rect x="108.44" y="108" width="490" height="490" fill="#fff"></rect></svg></button>
                                <button style="background:transparent !important;margin:2px;border:1px solid black;" id="duplicate"><svg width="25" height="25" id="Capa_1" x="0px" y="0px" viewBox="0 0 512 512" xml:space="preserve"><g><g><g><path d="M42.667,256c0-59.52,35.093-110.827,85.547-134.827V75.2C53.653,101.44,0,172.48,0,256s53.653,154.56,128.213,180.8 v-45.973C77.76,366.827,42.667,315.52,42.667,256z"></path><path d="M320,64c-105.92,0-192,86.08-192,192s86.08,192,192,192s192-86.08,192-192S425.92,64,320,64z M320,405.333 c-82.347,0-149.333-66.987-149.333-149.333S237.653,106.667,320,106.667S469.333,173.653,469.333,256 S402.347,405.333,320,405.333z"></path><polygon points="341.333,170.667 298.667,170.667 298.667,234.667 234.667,234.667 234.667,277.333 298.667,277.333 298.667,341.333 341.333,341.333 341.333,277.333 405.333,277.333 405.333,234.667 341.333,234.667  "></polygon></g></g></g></svg></button>
                                <button style="background:transparent !important;margin:2px;border:1px solid black;" id="delete"><svg width="25" height="25" id="Layer_1" x="0px" y="0px" viewBox="0 0 512 512" xml:space="preserve"><g><g><path d="M425.298,51.358h-91.455V16.696c0-9.22-7.475-16.696-16.696-16.696H194.855c-9.22,0-16.696,7.475-16.696,16.696v34.662 H86.704c-9.22,0-16.696,7.475-16.696,16.696v51.357c0,9.22,7.475,16.696,16.696,16.696h5.072l15.26,359.906 c0.378,8.937,7.735,15.988,16.68,15.988h264.568c8.946,0,16.302-7.051,16.68-15.989l15.259-359.906h5.073 c9.22,0,16.696-7.475,16.696-16.696V68.054C441.994,58.832,434.519,51.358,425.298,51.358z M211.551,33.391h88.9v17.967h-88.9 V33.391z M372.283,478.609H139.719l-14.522-342.502h261.606L372.283,478.609z M408.602,102.715c-15.17,0-296.114,0-305.202,0 V84.749h305.202V102.715z"></path></g></g><g><g><path d="M188.835,187.304c-9.22,0-16.696,7.475-16.696,16.696v206.714c0,9.22,7.475,16.696,16.696,16.696 c9.22,0,16.696-7.475,16.696-16.696V204C205.53,194.779,198.055,187.304,188.835,187.304z"></path></g></g><g><g><path d="M255.998,187.304c-9.22,0-16.696,7.475-16.696,16.696v206.714c0,9.22,7.474,16.696,16.696,16.696 c9.22,0,16.696-7.475,16.696-16.696V204C272.693,194.779,265.218,187.304,255.998,187.304z"></path></g></g><g><g><path d="M323.161,187.304c-9.22,0-16.696,7.475-16.696,16.696v206.714c0,9.22,7.475,16.696,16.696,16.696 s16.696-7.475,16.696-16.696V204C339.857,194.779,332.382,187.304,323.161,187.304z"></path></g></g></svg></button>
                               <hr>
                              </div>
                        </tr>
                        <script>
                            document.addEventListener('DOMContentLoaded', function () {
                                // Function to apply changes to selected objects
                                function applyToSelectedObjects(callback) {
                                    var activeObjects = canvas.getActiveObjects();
                                    if (activeObjects.length > 0) {
                                        activeObjects.forEach(callback);
                                        canvas.renderAll();
                                    }
                                }

                                // Flip Horizontal
                                document.getElementById('flip-h').onclick = function () {
                                    applyToSelectedObjects(function (object) {
                                        object.set('flipX', !object.flipX);
                                    });
                                };

                                // Flip Vertical
                                document.getElementById('flip-v').onclick = function () {
                                    applyToSelectedObjects(function (object) {
                                        object.set('flipY', !object.flipY);
                                    });
                                };

                                // Bring Forward
                                document.getElementById('bring-fwd').onclick = function () {
                                    applyToSelectedObjects(function (object) {
                                        canvas.bringForward(object);
                                    });
                                };

                                // Bring Backward
                                document.getElementById('bring-back').onclick = function () {
                                    applyToSelectedObjects(function (object) {
                                        canvas.sendBackwards(object);
                                    });
                                };

                                // Duplicate
                                document.getElementById('duplicate').onclick = function () {
                                    var activeObjects = canvas.getActiveObjects();
                                    if (activeObjects.length > 0) {
                                        activeObjects.forEach(function (object) {
                                            var clone = fabric.util.object.clone(object);
                                            clone.set({
                                                left: object.left + 10,
                                                top: object.top + 10
                                            });
                                            canvas.add(clone);
                                            clone.setCoords();
                                        });
                                        canvas.renderAll();
                                    }
                                };

                                // Delete
                                document.getElementById('delete').onclick = function () {
                                    var activeObjects = canvas.getActiveObjects();
                                    if (activeObjects.length > 0) {
                                        activeObjects.forEach(function (object) {
                                            canvas.remove(object);
                                        });
                                        canvas.discardActiveObject(); // Clear selection
                                        canvas.renderAll();
                                    }
                                };
                            });

                        </script>

<tr>
    <h4>ALignments:</h4>
    <button style="background:transparent;border:1px solid black;color:black;margin:2px" id="align-to-left"><svg width="25px" height="25px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path fill-rule="evenodd" clip-rule="evenodd" d="M3.375 1.625C3.78921 1.625 4.125 1.96079 4.125 2.375L4.125 22.375C4.125 22.7892 3.78921 23.125 3.375 23.125C2.96079 23.125 2.625 22.7892 2.625 22.375L2.625 2.375C2.625 1.96079 2.96079 1.625 3.375 1.625Z" fill="#1C274C"/>
        <path d="M7.375 7.875C7.375 6.94038 7.375 6.47308 7.57596 6.125C7.70761 5.89697 7.89697 5.70761 8.125 5.57596C8.47308 5.375 8.94038 5.375 9.875 5.375H18.875C19.8096 5.375 20.2769 5.375 20.625 5.57596C20.853 5.70761 21.0424 5.89697 21.174 6.125C21.375 6.47308 21.375 6.94038 21.375 7.875C21.375 8.80962 21.375 9.27692 21.174 9.625C21.0424 9.85303 20.853 10.0424 20.625 10.174C20.2769 10.375 19.8096 10.375 18.875 10.375L9.875 10.375C8.94038 10.375 8.47308 10.375 8.125 10.174C7.89697 10.0424 7.70761 9.85303 7.57596 9.625C7.375 9.27692 7.375 8.80962 7.375 7.875Z" fill="#1C274C"/>
        <path d="M7.375 16.875C7.375 15.9404 7.375 15.4731 7.57596 15.125C7.70761 14.897 7.89697 14.7076 8.125 14.576C8.47308 14.375 8.94038 14.375 9.875 14.375L15.875 14.375C16.8096 14.375 17.2769 14.375 17.625 14.576C17.853 14.7076 18.0424 14.897 18.174 15.125C18.375 15.4731 18.375 15.9404 18.375 16.875C18.375 17.8096 18.375 18.2769 18.174 18.625C18.0424 18.853 17.853 19.0424 17.625 19.174C17.2769 19.375 16.8096 19.375 15.875 19.375H9.875C8.94038 19.375 8.47308 19.375 8.125 19.174C7.89697 19.0424 7.70761 18.853 7.57596 18.625C7.375 18.2769 7.375 17.8096 7.375 16.875Z" fill="#1C274C"/>
        </svg></button>
<button style="background:transparent;border:1px solid black;color:black;margin:2px" id="align-to-right"><svg width="25px" height="25px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M20.625 1.625C20.2108 1.625 19.875 1.96079 19.875 2.375V22.375C19.875 22.7892 20.2108 23.125 20.625 23.125C21.0392 23.125 21.375 22.7892 21.375 22.375V2.375C21.375 1.96079 21.0392 1.625 20.625 1.625Z" fill="#1C274C"/>
<path d="M16.625 7.875C16.625 6.94038 16.625 6.47308 16.424 6.125C16.2924 5.89697 16.103 5.70761 15.875 5.57596C15.5269 5.375 15.0596 5.375 14.125 5.375L5.125 5.375C4.19038 5.375 3.72308 5.375 3.375 5.57596C3.14697 5.70761 2.95761 5.89697 2.82596 6.125C2.625 6.47307 2.625 6.94038 2.625 7.875C2.625 8.80961 2.625 9.27692 2.82596 9.625C2.95761 9.85303 3.14697 10.0424 3.375 10.174C3.72308 10.375 4.19038 10.375 5.125 10.375L14.125 10.375C15.0596 10.375 15.5269 10.375 15.875 10.174C16.103 10.0424 16.2924 9.85303 16.424 9.625C16.625 9.27692 16.625 8.80962 16.625 7.875Z" fill="#1C274C"/>
<path d="M16.625 16.875C16.625 15.9404 16.625 15.4731 16.424 15.125C16.2924 14.897 16.103 14.7076 15.875 14.576C15.5269 14.375 15.0596 14.375 14.125 14.375L8.125 14.375C7.19038 14.375 6.72308 14.375 6.375 14.576C6.14697 14.7076 5.95761 14.897 5.82596 15.125C5.625 15.4731 5.625 15.9404 5.625 16.875C5.625 17.8096 5.625 18.2769 5.82596 18.625C5.95761 18.853 6.14697 19.0424 6.375 19.174C6.72308 19.375 7.19038 19.375 8.125 19.375H14.125C15.0596 19.375 15.5269 19.375 15.875 19.174C16.103 19.0424 16.2924 18.853 16.424 18.625C16.625 18.2769 16.625 17.8096 16.625 16.875Z" fill="#1C274C"/>
</svg></button>
<button style="background:transparent;border:1px solid black;color:black;margin:2px" id="align-to-top">
<svg width="25px" height="25px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M1.25 3.75C1.25 4.16421 1.58579 4.5 2 4.5H22C22.4142 4.5 22.75 4.16421 22.75 3.75C22.75 3.33579 22.4142 3 22 3H2C1.58579 3 1.25 3.33579 1.25 3.75Z" fill="#1C274C"/>
<path d="M7.5 7.75C6.56538 7.75 6.09808 7.75 5.75 7.95096C5.52197 8.08261 5.33261 8.27197 5.20096 8.5C5 8.84808 5 9.31538 5 10.25L5 19.25C5 20.1846 5 20.6519 5.20096 21C5.33261 21.228 5.52197 21.4174 5.75 21.549C6.09808 21.75 6.56538 21.75 7.5 21.75C8.43462 21.75 8.90192 21.75 9.25 21.549C9.47803 21.4174 9.66739 21.228 9.79904 21C10 20.6519 10 20.1846 10 19.25V10.25C10 9.31538 10 8.84808 9.79904 8.5C9.66739 8.27197 9.47803 8.08261 9.25 7.95096C8.90192 7.75 8.43462 7.75 7.5 7.75Z" fill="#1C274C"/>
<path d="M16.5 7.75C15.5654 7.75 15.0981 7.75 14.75 7.95096C14.522 8.08261 14.3326 8.27197 14.201 8.5C14 8.84808 14 9.31538 14 10.25V16.25C14 17.1846 14 17.6519 14.201 18C14.3326 18.228 14.522 18.4174 14.75 18.549C15.0981 18.75 15.5654 18.75 16.5 18.75C17.4346 18.75 17.9019 18.75 18.25 18.549C18.478 18.4174 18.6674 18.228 18.799 18C19 17.6519 19 17.1846 19 16.25V10.25C19 9.31538 19 8.84808 18.799 8.5C18.6674 8.27197 18.478 8.08261 18.25 7.95096C17.9019 7.75 17.4346 7.75 16.5 7.75Z" fill="#1C274C"/>
</svg>
</button>
<button style="background:transparent;border:1px solid black;color:black;margin:2px" id="align-to-bottom"><svg width="25px" height="25px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M7.5 17C6.56538 17 6.09808 17 5.75 16.799C5.52197 16.6674 5.33261 16.478 5.20096 16.25C5 15.9019 5 15.4346 5 14.5L5 5.5C5 4.56538 5 4.09808 5.20096 3.75C5.33261 3.52197 5.52197 3.33261 5.75 3.20096C6.09808 3 6.56538 3 7.5 3C8.43462 3 8.90192 3 9.25 3.20096C9.47803 3.33261 9.66739 3.52197 9.79904 3.75C10 4.09808 10 4.56538 10 5.5V14.5C10 15.4346 10 15.9019 9.79904 16.25C9.66739 16.478 9.47803 16.6674 9.25 16.799C8.90192 17 8.43462 17 7.5 17Z" fill="#1C274C"/>
<path d="M16.5 17C15.5654 17 15.0981 17 14.75 16.799C14.522 16.6674 14.3326 16.478 14.201 16.25C14 15.9019 14 15.4346 14 14.5V8.5C14 7.56538 14 7.09808 14.201 6.75C14.3326 6.52197 14.522 6.33261 14.75 6.20096C15.0981 6 15.5654 6 16.5 6C17.4346 6 17.9019 6 18.25 6.20096C18.478 6.33261 18.6674 6.52197 18.799 6.75C19 7.09808 19 7.56538 19 8.5V14.5C19 15.4346 19 15.9019 18.799 16.25C18.6674 16.478 18.478 16.6674 18.25 16.799C17.9019 17 17.4346 17 16.5 17Z" fill="#1C274C"/>
<g opacity="0.5">
<path fill-rule="evenodd" clip-rule="evenodd" d="M1.25 21C1.25 20.5858 1.58579 20.25 2 20.25H22C22.4142 20.25 22.75 20.5858 22.75 21C22.75 21.4142 22.4142 21.75 22 21.75H2C1.58579 21.75 1.25 21.4142 1.25 21Z" fill="#1C274C"/>
</g>
</svg></button>
</tr>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Function to apply alignment to selected objects
        function alignObjects(callback) {
            var activeObjects = canvas.getActiveObjects().filter(function (obj) {
                return obj.type !== 'text'; // Exclude text objects
            });
            if (activeObjects.length > 0) {
                callback(activeObjects);
                canvas.renderAll(); // Ensure the canvas is re-rendered
            }
        }

        // Align to Left
        document.getElementById('align-to-left').onclick = function () {
            alignObjects(function (objects) {
                var minLeft = Math.min(...objects.map(o => o.left));
                objects.forEach(function (object) {
                    object.set('left', minLeft);
                    object.setCoords(); // Update the coordinates for the selection box
                });
            });
        };

        // Align to Right
        document.getElementById('align-to-right').onclick = function () {
            alignObjects(function (objects) {
                var maxRight = Math.max(...objects.map(o => o.left + o.width));
                objects.forEach(function (object) {
                    object.set('left', maxRight - object.width);
                    object.setCoords(); // Update the coordinates for the selection box
                });
            });
        };

        // Align to Top
        document.getElementById('align-to-top').onclick = function () {
            alignObjects(function (objects) {
                var minTop = Math.min(...objects.map(o => o.top));
                objects.forEach(function (object) {
                    object.set('top', minTop);
                    object.setCoords(); // Update the coordinates for the selection box
                });
            });
        };

        // Align to Bottom
        document.getElementById('align-to-bottom').onclick = function () {
            alignObjects(function (objects) {
                var maxBottom = Math.max(...objects.map(o => o.top + o.height));
                objects.forEach(function (object) {
                    object.set('top', maxBottom - object.height);
                    object.setCoords(); // Update the coordinates for the selection box
                });
            });
        };

        // Center Horizontally
        document.getElementById('center-horizontal').onclick = function () {
            alignObjects(function (objects) {
                var canvasWidth = canvas.getWidth();
                var minLeft = Math.min(...objects.map(o => o.left));
                var maxRight = Math.max(...objects.map(o => o.left + o.width));
                var totalWidth = maxRight - minLeft;
                var centerX = (canvasWidth - totalWidth) / 2;
                objects.forEach(function (object) {
                    object.set('left', centerX + object.left - minLeft);
                    object.setCoords(); // Update the coordinates for the selection box
                });
            });
        };

        // Center Vertically
        document.getElementById('center-vertical').onclick = function () {
            alignObjects(function (objects) {
                var canvasHeight = canvas.getHeight();
                var minTop = Math.min(...objects.map(o => o.top));
                var maxBottom = Math.max(...objects.map(o => o.top + o.height));
                var totalHeight = maxBottom - minTop;
                var centerY = (canvasHeight - totalHeight) / 2;
                objects.forEach(function (object) {
                    object.set('top', centerY + object.top - minTop);
                    object.setCoords(); // Update the coordinates for the selection box
                });
            });
        };
    });

</script>
<hr>
<br>
                        <tr >
                            <span style="font-weight: bold;">Set Position:</span><br>

                            <button style="margin: 2px;background: transparent;border: 1px solid gainsboro;" id="align-center-top" title="Align Center Top"><img height="25" width="25" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAABCElEQVR4nO2ZQWqDUBCGvzPlDC1R0jQ9QDcNhKQHbVal6QmaRQ/RZBENwiwej1GkC5kn/wcDojPP9/GrG0EIIcRMebIqmgq4WHXHRbIE/oDW6gqsKVyiLVGm6pFIZZ4pXKItQaYaKRFaZmVfpnSjN2fz+bmLzYagdpJogIMj8ubIdMlsokq82/VcpGMbTaZ2HqdUok9kSOZlaolHu3Euscv6+kSw3saReZjQgy9HYu/0DYlgM7nMJxNydF5s/iGCzaYyH0zIAvgGzsDrQN8YEWyNbq2TrR2OsSLhaSUSDCUSDSUSDSUSDSUSDSUSDSUSDSUSjdkkck4kfiiYGvi1KvZHjxBCiPlzByBF6fap882hAAAAAElFTkSuQmCC"></button>
                            <button style="margin: 2px;background: transparent;border: 1px solid gainsboro;" id="align-center-bottom" title="Align Center Bottom"><img height="25" width="25" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAABI0lEQVR4nO3YXUsCQRiG4Zv6Xx1IZEFFlHVSIhadRD+7jDqQIizXPiYGRliWGTOR2XfiuWBAxJW5fV1xF0REROw6AcbAE3BIwR4AF9YdBXONVSynEGM0EWs0EWs0EWs0EWs0EWs0EWs0EWvMT6QPPAOPQG8NIb1wWTwC9slkE3ipbe4zhK0a0g/vMX/NPZlshDsj9Q36jQxWCBk0IlzOEO8ssoEvYPiHkGE4pvmBHJPZKfDR2Mg3cLNEyGUi4oKW+JN0tiAmFnKViDinZf5XZhqJuY2EXEciZm18nVKOgCoS4355rgrHmrIHvEc2n1omI+Z2l4ypSrip3QXeFkT48+mAQuwkYqY5/4KsyxbwWouYANsUqhMCJuFx0Tr/IUJERIj5AXrs6zGCTBgSAAAAAElFTkSuQmCC"></button>
                            <button style="margin: 2px;background: transparent;border: 1px solid gainsboro;" id="align-top-left" title="Align Top Left"><img height="25" width="25" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAzElEQVR4nO3YsQrCMBjE8Xs8u9glkMVnt2DBl1A4ETqFVNta6Hfx/pDBzR+3JAWcc38ddzoDgK4FCAGMhuzQXmtcAZwiQp4ALhCKrWBYnEfld4YgJFUwEsuwOFDFsAKRxHAGIofhB4gUhl8gMhgugEhguBASHsMVkNAYroSExXADJCRmKK7iUMV008tu3PieyMoXzdDL/JoxUfMyUfMyUfMyUfMyUfMyUUu+aAYttbRMnnmc9WgEc4NoucDcIVw/fRB5r3E++s8453BcL9KbTZi0iQWWAAAAAElFTkSuQmCC"></button>
                            <button style="margin: 2px;background: transparent;border: 1px solid gainsboro;" id="align-top-right" title="Align Top Right"><img height="25" width="25" style="transform: rotate(90deg);" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAzElEQVR4nO3YsQrCMBjE8Xs8u9glkMVnt2DBl1A4ETqFVNta6Hfx/pDBzR+3JAWcc38ddzoDgK4FCAGMhuzQXmtcAZwiQp4ALhCKrWBYnEfld4YgJFUwEsuwOFDFsAKRxHAGIofhB4gUhl8gMhgugEhguBASHsMVkNAYroSExXADJCRmKK7iUMV008tu3PieyMoXzdDL/JoxUfMyUfMyUfMyUfMyUfMyUUu+aAYttbRMnnmc9WgEc4NoucDcIVw/fRB5r3E++s8453BcL9KbTZi0iQWWAAAAAElFTkSuQmCC"></button>
                            <button style="margin: 2px;background: transparent;border: 1px solid gainsboro;" id="align-bottom-left" title="Align Bottom Left"><img height="25" width="25" style="transform: rotate(270deg);"  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAzElEQVR4nO3YsQrCMBjE8Xs8u9glkMVnt2DBl1A4ETqFVNta6Hfx/pDBzR+3JAWcc38ddzoDgK4FCAGMhuzQXmtcAZwiQp4ALhCKrWBYnEfld4YgJFUwEsuwOFDFsAKRxHAGIofhB4gUhl8gMhgugEhguBASHsMVkNAYroSExXADJCRmKK7iUMV008tu3PieyMoXzdDL/JoxUfMyUfMyUfMyUfMyUfMyUUu+aAYttbRMnnmc9WgEc4NoucDcIVw/fRB5r3E++s8453BcL9KbTZi0iQWWAAAAAElFTkSuQmCC"></button>
                            <button style="margin: 2px;background: transparent;border: 1px solid gainsboro;" id="align-bottom-right" title="Align Bottom Right"><img height="25" width="25" style="transform: rotate(180deg);"  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAzElEQVR4nO3YsQrCMBjE8Xs8u9glkMVnt2DBl1A4ETqFVNta6Hfx/pDBzR+3JAWcc38ddzoDgK4FCAGMhuzQXmtcAZwiQp4ALhCKrWBYnEfld4YgJFUwEsuwOFDFsAKRxHAGIofhB4gUhl8gMhgugEhguBASHsMVkNAYroSExXADJCRmKK7iUMV008tu3PieyMoXzdDL/JoxUfMyUfMyUfMyUfMyUfMyUUu+aAYttbRMnnmc9WgEc4NoucDcIVw/fRB5r3E++s8453BcL9KbTZi0iQWWAAAAAElFTkSuQmCC"></button>
                            <button style="margin: 2px;background: transparent;border: 1px solid gainsboro;" id="align-center-both" title="Align Center"><img height="25" width="25"  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAAxCAYAAABznEEcAAAACXBIWXMAAAsTAAALEwEAmpwYAAABmElEQVR4nO2asUrDUBSGP+kgDoLg5ODk4qCri+IL1MFFoavUlvoCfQUfQAehFFcnX6GTU0ClTsVBxC4OdlIEhZYrZwghLTW5SU/K+eBCe256z/3v3+TmhIB/asAvMIxpLn5KAbiQCbeBq1BrS9z1F0bEciTuvpuIPDEntGBOaMGc0II5oQVzQgvmRFZUgfqMnKhL/tR0JfklUMpJREnyDSV/ap5CldktsJSxiEXgJpTT5U+NG+ReqjM36B2wmpGIFaAjx10Djz5FBPK5GVqddc8i1mSx3DHnwILk9S7CcQL8AH1g25OIDeBZHiScheKZiXAcAl/AB7CXUsQO8A58A8eRvqlFuNU8mtBeY0Q49oEB8AkcJBRRlt8PZLwogeSfNL+/f0N/zDOicIsT4ahIfy+hiJ7EKmPGD6aY25svJ8ozdGILD+fEroZzIunV6QXYLOLVqVnkfeIBaEmCjuysWe/YLcnrTUTh752683AXWwUaM6onGr7qif9i5akWzAktmBNaMCe0YE5owZzQgjmhhbl4y6aW9/tOI6SVPASB+qyRAAAAAElFTkSuQmCC"></button>


                        </tr>
                        <br>
                        <tr>

                            <div class="row">
                                <div class="col-xs-12">
                                    <div class="form-group">
                                        <label for="width-input">Width:</label>
                                        <div class="input-group">
                                            <input type="text" id="width-input" class="form-control" placeholder="Enter width">
                                            <div class="input-group-btn">
                                                <select id="width-unit" class="btn btn-default">
                                                    <option value="px">px</option>
                                                    <option value="cm">cm</option>
                                                    <option value="in">inches</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xs-12">
                                    <div class="form-group">
                                        <label for="height-input">Height:</label>
                                        <div class="input-group">
                                            <input type="text" id="height-input" class="form-control" placeholder="Enter height">
                                            <div class="input-group-btn">
                                                <select id="height-unit" class="btn btn-default">
                                                    <option value="px">px</option>
                                                    <option value="cm">cm</option>
                                                    <option value="in">inches</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button id="apply-dimensions" class="btn btn-primary">Apply</button>


                        </tr>
                        <br>
                        <tr style="border-bottom: 1px solid black;display: none;" id="drawingTable">
                                <label for="color-picke" id="color-picker-label" style="display: none;">Color:</label>
                                <input type="color" id="color-picker" value="#000000" style="display: none;">
                                <label for="width-slider" id="width-slider-label" style="display: none;">Size:</label>
                                <input type="range" id="width-slider" min="1" max="100" value="5" style="display: none;">
                        </tr>
                        <tr>
                            <style>
                                #controls {
                                    display: none;
                                }
                            </style>
                            <div id="controls">
                                <label for="">Color:</label><br>
                                <input type="color" id="lineColor" value="#ff0000">
                                <br>
                                <label for="">Width:</label><br>
                                <input type="range" id="lineWidth" min="1" max="10" value="5">
                            </div>
                            <hr>
                        </tr>
                        <tr>
                            <h2>{{ single_product.product_name }}</h2>

                            {% if single_product.stock <= 0 %}
                            <h3 style="color: #ff7878;font-weight: bold;">Out of Stock</h3>
                            {% else %}
                            <h3 style="color: #ff7878;font-weight: bold;">Price: {{single_product.price}}  <span style="font-size: 17px;color: gray;"><del>{{single_product.discount_price}}</del></span></h3>
                            {% endif %}
                        </tr>

                    </table>
                </p>


                  <a  href="{% url 'order_product' single_product.slug %}" class="btn btn-large btn-block btn-success" name="download-all-pages" id="download-all-pages">Order Now&nbsp; <i class="fa fa-shopping-basket"></i></a>
            </div>
          </div>
        </div>
    </div>
</div>
<script>
    document.getElementById('download-all-pages').addEventListener('click', function (event) {
        event.preventDefault(); // Prevent the default link behavior

        var button = event.target;
        var originalText = button.textContent;
        button.textContent = "Loading..."; // Change button text to indicate loading

        var zip = new JSZip();
        var pageCount = pages.length;

        function saveCanvasAsPng(pageIndex) {
            return new Promise((resolve) => {
                loadPage(pageIndex); // Load the correct page with its specific image
                setTimeout(function () {
                    html2canvas(document.getElementById('shirtDiv')).then(function (canvas) {
                        canvas.toBlob(function (blob) {
                            zip.file('page-' + (pageIndex + 1) + '.png', blob);
                            resolve();
                        });
                    });
                }, 500); // Delay to ensure the page and canvas are fully rendered
            });
        }

        async function downloadAllPages() {
            for (var i = 0; i < pageCount; i++) {
                await saveCanvasAsPng(i); // Wait for each page to be processed before moving to the next
            }
            zip.generateAsync({ type: 'blob' }).then(function (content) {
                saveAs(content, 'shirt-designs.zip'); // Download the ZIP file containing all pages
                setTimeout(function () {
                    window.location.href = button.href; // Redirect to the specified page
                }, 2000); // Delay redirect to ensure download completes
            });
        }

        downloadAllPages(); // Initiate the download process
    });
</script>

<br><br><br>
{% include "includes/footer.html" %}




<script src="{% static 'assets/js/bootstrap.min.js' %}"></script>
<script src="{% static 'assets/js/bootstrap-hover-dropdown.min.js' %}"></script>
<script src="{% static 'assets/js/scripts.js' %}"></script>
<script src="{% static 'custom/js/shapes.js' %}"></script>

<script type="text/javascript">


$('#flip').click(
		   function() {
			   	if ($(this).attr("data-original-title") == "Show Back View") {
			   		$(this).attr('data-original-title', 'Show Front View');
			        $("#tshirtFacing").attr("src",`{{single_product.images_hover.url}}`);
			        a = JSON.stringify(canvas);
			        canvas.clear();
			        try
			        {
			           var json = JSON.parse(b);
			           canvas.loadFromJSON(b);
			        }
			        catch(e)
			        {}

			    } else {
			    	$(this).attr('data-original-title', 'Show Back View');
			    	$("#tshirtFacing").attr("src",`{{single_product.images.url}}`);
			    	b = JSON.stringify(canvas);
			    	canvas.clear();
			    	try
			        {
			           var json = JSON.parse(a);
			           canvas.loadFromJSON(a);
			        }
			        catch(e)
			        {}
			    }
			   	canvas.renderAll();
			   	setTimeout(function() {
			   		canvas.calcOffset();
			    },200);
});


var opacitySlider = document.getElementById('opacity-slider');

// Add event listener to the opacity slider
opacitySlider.addEventListener('input', function() {
    var activeObject = canvas.getActiveObject();
    if (activeObject && activeObject.type === 'image') {
        activeObject.set('opacity', parseFloat(this.value));
        canvas.renderAll();
    }
});


// ======================free drawing

// Get the canvas element
// Add a button to toggle the drawing mode
var drawingModeButton = document.getElementById('drawing-mode');
// Add a color picker to change the brush color
var colorPicker = document.getElementById('color-picker');
var colorPickerLabel = document.getElementById('color-picker-label');
// Add a width slider to change the brush width
var widthSlider = document.getElementById('width-slider');
var widthSliderLabel = document.getElementById('width-slider-label');
var drawingTable = document.getElementById('drawingTable');


// Add an event listener to the color picker
colorPicker.addEventListener('change', function() {
  if (canvas.isDrawingMode) {
    // Change the brush color
    canvas.freeDrawingBrush.color = this.value;
    canvas.freeDrawingBrush.dirty = true;
    canvas.renderAll();
  }
});

// Add an event listener to the width slider
widthSlider.addEventListener('change', function() {
  if (canvas.isDrawingMode) {
    // Change the brush width
    canvas.freeDrawingBrush.width = parseInt(this.value);
    canvas.freeDrawingBrush.dirty = true;
    canvas.renderAll();
  }
});

// Add an event listener to the button
drawingModeButton.addEventListener('click', function() {
  // Toggle the drawing mode
  canvas.isDrawingMode = !canvas.isDrawingMode;

  if (canvas.isDrawingMode) {
    // Change the button icon and text to "Stop Drawing"
    drawingModeButton.innerHTML = '<i class="fa fa-stop"></i> '; // Stop icon
    // Show the color picker and width slider
    colorPicker.style.display = 'block';
    widthSlider.style.display = 'block';
    colorPickerLabel.style.display = 'block';
    widthSliderLabel.style.display = 'block';
    drawingTable.style.display = 'block';

    // Set the drawing options
    canvas.freeDrawingBrush.color = colorPicker.value;
    canvas.freeDrawingBrush.width = parseInt(widthSlider.value);
    canvas.freeDrawingBrush.dirty = true;
    canvas.renderAll();
  } else {
    // Change the button icon and text to "Start Drawing"
    drawingModeButton.innerHTML = '<i class="fa fa-pencil"></i> '; // Pencil icon
    // Hide the color picker and width slider
    colorPicker.style.display = 'none';
    widthSlider.style.display = 'none';
    colorPickerLabel.style.display = 'none';
    widthSliderLabel.style.display = 'none';
    drawingTable.style.display = 'none';

  }
});


// end free drawing

// Function to resize selected object by scaling
function resizePlus() {
            var activeObject = canvas.getActiveObject();
            if (activeObject) {
                activeObject.scaleX *= 1.1;
                activeObject.scaleY *= 1.1;
                canvas.renderAll();
            }
        }

        function resizeMinus() {
            var activeObject = canvas.getActiveObject();
            if (activeObject) {
                activeObject.scaleX *= 0.9;
                activeObject.scaleY *= 0.9;
                canvas.renderAll();
            }
        }

        function rotate() {
            var activeObject = canvas.getActiveObject();
            if (activeObject) {
                activeObject.rotate(activeObject.angle + 45);
                canvas.renderAll();
            }
        }


        $(document).ready(function() {
            var line, isDown;
            var mode = "select"; // Default mode
            var lineColor = '#ff0000'; // Default color
            var lineWidth = 5; // Default width

            $("#draw").click(function(){
                if (mode === "draw") {
                    mode = "select";
                    canvas.selection = true;
                    canvas.isDrawingMode = false;
                    $("#draw").html('<i class="fa fa-minus" style="transform: rotate(120deg);"></i>');
                    $("#canvas-container").removeClass('draw-cursor');
                    $("#controls").hide(); // Hide controls
                } else {
                    mode = "draw";
                    canvas.selection = false;
                    canvas.isDrawingMode = false;
                    $("#draw").html('<i class="fa fa-stop"></i>');
                    $("#canvas-container").addClass('draw-cursor');
                    $("#controls").show(); // Show controls
                }
            });

            $("#lineColor").change(function(){
                lineColor = $(this).val();
            });

            $("#lineWidth").change(function(){
                lineWidth = $(this).val();
            });

            canvas.on('mouse:down', function(o){
                if (mode === "draw") {
                    isDown = true;
                    var pointer = canvas.getPointer(o.e);
                    var points = [pointer.x, pointer.y, pointer.x, pointer.y];
                    line = new fabric.Line(points, {
                        strokeWidth: lineWidth,
                        fill: lineColor,
                        stroke: lineColor,
                        originX: 'center',
                        originY: 'center',
                    });
                    canvas.add(line);
                }
            });

            canvas.on('mouse:move', function(o){
                if (mode === "draw" && isDown) {
                    var pointer = canvas.getPointer(o.e);
                    line.set({ x2: pointer.x, y2: pointer.y });
                    canvas.renderAll();
                }
            });

            canvas.on('mouse:up', function(o){
                if (mode === "draw") {
                    isDown = false;
                }
            });


        });




            var cropper;
            var cropImageElement = document.getElementById('cropImage');

            function uploadLogo(event) {
                var file = event.target.files[0];
                if (file) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        cropImageElement.src = e.target.result;
                        $('#cropModal').modal('show');

                        // Destroy previous cropper if it exists
                        if (cropper) {
                            cropper.destroy();
                        }

                        // Initialize cropper
                        cropper = new Cropper(cropImageElement, {
                            aspectRatio: NaN, // Free aspect ratio
                            viewMode: 1,
                            autoCropArea: 1,
                            responsive: true,
                            background: false,
                            zoomable: true
                        });
                    };
                    reader.readAsDataURL(file);
                }
            }

            document.getElementById('cropImageButton').addEventListener('click', function () {
                var canvasCrop = cropper.getCroppedCanvas();
                var croppedImage = canvasCrop.toDataURL('image/png');

                var imgElement = new Image();
                imgElement.src = croppedImage;

                imgElement.onload = function () {
                    var imgInstance = new fabric.Image(imgElement, {
                        left: 100,
                        top: 100,
                        angle: 0,
                        opacity: 1
                    });

                    if (canvas instanceof fabric.Canvas) {
                        canvas.add(imgInstance);
                        canvas.setActiveObject(imgInstance);
                        canvas.renderAll();
                    } else {
                        console.error('Canvas instance is not valid.');
                    }

                    $('#cropModal').modal('hide');
                };
            });

            $('#cropModal').on('hidden.bs.modal', function () {
                var fileInput = document.getElementById('ownlogo');
			    fileInput.value = '';
            });




            function clearCanvas() {
                canvas.clear();
                canvas.renderAll();
            }

            // Attach clearCanvas function to the button click event
            document.getElementById('clearCanvasButton').addEventListener('click', clearCanvas);




            // Add event listener to option images
        document.querySelectorAll('.optionImage').forEach(function(img) {
            img.addEventListener('click', function() {
                var imgSrc = this.src;

                // Set the image source for the <img> element
                document.getElementById('tshirtFacing').src = imgSrc;

                // Clear the canvas
                canvas.clear();
                canvas.renderAll();
            });
        });

    </script>


<script>



function alignCenterTop() {
    var activeObject = canvas.getActiveObject();
    if (activeObject) {
        var canvasWidth = canvas.getWidth();
        var canvasHeight = canvas.getHeight();
        activeObject.set({
            left: (canvasWidth - activeObject.getScaledWidth()) / 2,
            top: 0
        });
        activeObject.setCoords();
        canvas.renderAll();
    }
}

function alignCenterBottom() {
    var activeObject = canvas.getActiveObject();
    if (activeObject) {
        var canvasWidth = canvas.getWidth();
        var canvasHeight = canvas.getHeight();
        activeObject.set({
            left: (canvasWidth - activeObject.getScaledWidth()) / 2,
            top: canvasHeight - activeObject.getScaledHeight()
        });
        activeObject.setCoords();
        canvas.renderAll();
    }
}

function alignTopLeft() {
    var activeObject = canvas.getActiveObject();
    if (activeObject) {
        activeObject.set({ left: 0, top: 0 });
        activeObject.setCoords();
        canvas.renderAll();
    }
}

function alignTopRight() {
    var activeObject = canvas.getActiveObject();
    if (activeObject) {
        var canvasWidth = canvas.getWidth();
        activeObject.set({ left: canvasWidth - activeObject.getScaledWidth(), top: 0 });
        activeObject.setCoords();
        canvas.renderAll();
    }
}

function alignBottomLeft() {
    var activeObject = canvas.getActiveObject();
    if (activeObject) {
        var canvasHeight = canvas.getHeight();
        activeObject.set({ left: 0, top: canvasHeight - activeObject.getScaledHeight() });
        activeObject.setCoords();
        canvas.renderAll();
    }
}

function alignBottomRight() {
    var activeObject = canvas.getActiveObject();
    if (activeObject) {
        var canvasWidth = canvas.getWidth();
        var canvasHeight = canvas.getHeight();
        activeObject.set({
            left: canvasWidth - activeObject.getScaledWidth(),
            top: canvasHeight - activeObject.getScaledHeight()
        });
        activeObject.setCoords();
        canvas.renderAll();
    }
}

function alignCenterBoth() {
    var activeObject = canvas.getActiveObject();
    if (activeObject) {
        var canvasWidth = canvas.getWidth();
        var canvasHeight = canvas.getHeight();
        var objectWidth = activeObject.getScaledWidth();
        var objectHeight = activeObject.getScaledHeight();

        activeObject.set({
            left: (canvasWidth - objectWidth) / 2,
            top: (canvasHeight - objectHeight) / 2
        });
        activeObject.setCoords();
        canvas.renderAll();
    }
}

document.getElementById('align-center-top').addEventListener('click', alignCenterTop);
document.getElementById('align-center-bottom').addEventListener('click', alignCenterBottom);
document.getElementById('align-top-left').addEventListener('click', alignTopLeft);
document.getElementById('align-top-right').addEventListener('click', alignTopRight);
document.getElementById('align-bottom-left').addEventListener('click', alignBottomLeft);
document.getElementById('align-bottom-right').addEventListener('click', alignBottomRight);
document.getElementById('align-center-both').addEventListener('click', alignCenterBoth);






// =======================


document.addEventListener('DOMContentLoaded', function() {
    var pages = [
        { bgGradient: null, bgColor: null },
        { bgGradient: null, bgColor: null },
        { bgGradient: null, bgColor: null },
        { bgGradient: null, bgColor: null },
        { bgGradient: null, bgColor: null }
    ];
    var currentPage = 0;

    function toggleColorOptions() {
        var colorType = document.querySelector('input[name="colorType"]:checked').value;
        var plainColorOptions = document.getElementById('plainColorOptions');
        var gradientColorOptions = document.getElementById('gradientColorOptions');

        if (colorType === 'plain') {
            plainColorOptions.style.display = 'block';
            gradientColorOptions.style.display = 'none';
        } else {
            plainColorOptions.style.display = 'none';
            gradientColorOptions.style.display = 'block';
        }
    }

    function toggleDegreeInput() {
        var direction = document.getElementById('gradientDirection').value;
        var degreeInputContainer = document.getElementById('degreeInputContainer');

        if (direction === 'custom') {
            degreeInputContainer.style.display = 'block';
        } else {
            degreeInputContainer.style.display = 'none';
        }
    }

    function updateGradientColorInputs() {
        var numColors = parseInt(document.getElementById('numGradientColors').value);
        var gradientColorInputs = document.getElementById('gradientColorInputs');

        // Clear current inputs
        gradientColorInputs.innerHTML = '';

        // Add start color
        gradientColorInputs.appendChild(createColorInput('gradientStart', 'Start Color', '#ffffff'));

        // Add middle colors based on selected number
        for (var i = 1; i <= numColors - 2; i++) {
            gradientColorInputs.appendChild(createColorInput(`gradientMid${i}`, `Mid Color ${i}`, '#888888'));
        }

        // Add end color
        gradientColorInputs.appendChild(createColorInput('gradientEnd', 'End Color', '#1f1e1e'));

        // Add event listeners for the new inputs
        document.querySelectorAll('.gradient-color-input').forEach(function(input) {
            input.addEventListener('input', applyGradientColor);
        });
    }

    function createColorInput(id, labelText, defaultValue) {
        var container = document.createElement('div');
        var label = document.createElement('label');
        var input = document.createElement('input');

        label.setAttribute('for', id);
        label.textContent = labelText;

        input.setAttribute('type', 'color');
        input.setAttribute('class', 'form-control gradient-color-input');
        input.setAttribute('id', id);
        input.setAttribute('name', id);
        input.setAttribute('value', defaultValue);

        container.appendChild(label);
        container.appendChild(input);

        return container;
    }

    function applyPlainColor(event) {
        if (document.querySelector('input[name="colorType"]:checked').value === 'plain') {
            var color = event.target.style.backgroundColor || event.target.getAttribute('title');
            if (color && color !== 'rgba(0, 0, 0, 0)') {
                var shirtDiv = document.getElementById('shirtDiv');
                shirtDiv.style.backgroundColor = color;
                shirtDiv.style.backgroundImage = ''; // Clear any gradient if plain color is selected

                // Save the background color for the current page
                pages[currentPage].bgGradient = null; // Clear any gradient
                pages[currentPage].bgColor = color;
            }
        }
    }

    function applyGradientColor() {
        if (document.querySelector('input[name="colorType"]:checked').value === 'gradient') {
            var gradientType = document.getElementById('gradientType').value;
            var direction = document.getElementById('gradientDirection').value;
            var colors = [];

            document.querySelectorAll('.gradient-color-input').forEach(function(input) {
                colors.push(input.value);
            });

            if (direction === 'custom') {
                var degree = document.getElementById('gradientDegree').value;
                direction = `${degree}deg`;
            }

            var gradient = '';

            if (gradientType === 'linear') {
                gradient = `linear-gradient(${direction}, ${colors.join(', ')})`;
            } else if (gradientType === 'radial') {
                gradient = `radial-gradient(circle, ${colors.join(', ')})`;
            }

            var shirtDiv = document.getElementById('shirtDiv');
            shirtDiv.style.backgroundImage = gradient;
            shirtDiv.style.backgroundColor = ''; // Clear plain color if gradient is selected

            // Save the gradient for the current page
            pages[currentPage].bgGradient = gradient;
            pages[currentPage].bgColor = null; // Clear any plain color
        }
    }

    function loadPage(pageIndex) {
        saveCurrentPage(); // Save the current page before switching
        currentPage = pageIndex;

        var shirtDiv = document.getElementById('shirtDiv');

        if (pages[pageIndex].bgGradient) {
            shirtDiv.style.backgroundImage = pages[pageIndex].bgGradient;
            shirtDiv.style.backgroundColor = ''; // Clear plain color
        } else {
            shirtDiv.style.backgroundColor = pages[pageIndex].bgColor || "#ffffff"; // Default to white if no color is set
            shirtDiv.style.backgroundImage = ''; // Clear gradient if plain color is selected
        }

        // Clear and restore the canvas
        canvas.clear();
        canvas.loadFromJSON(pages[pageIndex].canvasState, function() {
            canvas.renderAll();

            // Ensure all objects are selectable
            canvas.forEachObject(function(obj) {
                obj.set('selectable', true);
            });
            canvas.renderAll();
        });
    }

    document.querySelectorAll('input[name="colorType"]').forEach(function(radio) {
        radio.addEventListener('change', toggleColorOptions);
    });

    document.querySelectorAll('.color-preview').forEach(function(item) {
        item.addEventListener('click', applyPlainColor);
    });

    document.getElementById('gradientType').addEventListener('change', applyGradientColor);
    document.getElementById('numGradientColors').addEventListener('change', function() {
        updateGradientColorInputs();
        applyGradientColor();
    });
    document.getElementById('gradientDirection').addEventListener('change', function() {
        toggleDegreeInput();
        applyGradientColor();
    });
    document.getElementById('gradientDegree').addEventListener('input', applyGradientColor);

    // Initialize on page load
    toggleColorOptions();
    toggleDegreeInput();
    updateGradientColorInputs();
    loadPage(currentPage);
});




// ==============================



var CM_TO_PX = 96 / 2.54; // Pixels per cm
var INCH_TO_PX = 96;      // Pixels per inch





// Get the width and height inputs, unit dropdowns, and apply button
var widthInput = document.getElementById('width-input');
var heightInput = document.getElementById('height-input');
var widthUnit = document.getElementById('width-unit');
var heightUnit = document.getElementById('height-unit');
var applyButton = document.getElementById('apply-dimensions');

// Function to convert from pixels to other units
function convertFromPixels(value, unit) {
    if (unit === 'cm') {
        return value / CM_TO_PX;
    } else if (unit === 'in') {
        return value / INCH_TO_PX;
    } else {
        return value; // Default to pixels
    }
}

// Function to convert to pixels from other units
function convertToPixels(value, unit) {
    if (unit === 'cm') {
        return value * CM_TO_PX;
    } else if (unit === 'in') {
        return value * INCH_TO_PX;
    } else {
        return value; // Default to pixels
    }
}

// Function to update the input fields with the object's current size in the selected unit
function updateInputs(object) {
    if (object) {
        var currentWidthPx = object.getScaledWidth();
        var currentHeightPx = object.getScaledHeight();

        // Convert the current dimensions to the selected units
        widthInput.value = convertFromPixels(currentWidthPx, widthUnit.value).toFixed(2);
        heightInput.value = convertFromPixels(currentHeightPx, heightUnit.value).toFixed(2);
    }
}

// Add event listeners to the unit dropdowns to update the displayed dimensions when units change
widthUnit.addEventListener('change', function() {
    updateInputs(canvas.getActiveObject());
});

heightUnit.addEventListener('change', function() {
    updateInputs(canvas.getActiveObject());
});

// Function to handle object selection
function onObjectSelected(object) {
    updateInputs(object); // Immediately update inputs with selected object's dimensions
}

// Add an event listener to the apply button
applyButton.addEventListener('click', function() {
    var activeObject = canvas.getActiveObject();
    if (activeObject) {
        var newWidth = convertToPixels(parseFloat(widthInput.value), widthUnit.value);
        var newHeight = convertToPixels(parseFloat(heightInput.value), heightUnit.value);

        activeObject.set({
            scaleX: newWidth / activeObject.width,
            scaleY: newHeight / activeObject.height
        });

        activeObject.setCoords(); // Update the coordinates for correct selection
        canvas.renderAll();
    }
});

// Clear input fields when selection is cleared
function onSelectedCleared() {
    widthInput.value = '';
    heightInput.value = '';
}

</script>
</body>
</html>
